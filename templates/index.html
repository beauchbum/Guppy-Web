{% block body %}

<!DOCTYPE HTML>


<!--
	Alpha by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
		<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
		<link rel="manifest" href="/manifest.json">
		<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
		<meta name="theme-color" content="#ffffff">		  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
		<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
		<link rel="stylesheet" href="/static/css/main.css" />

<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '809771009177977',
      cookie     : true,
      xfbml      : true,
      version    : 'v2.8'
    });
    FB.AppEvents.logPageView();   
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>

		
	<script>
	
	function validateForm(form) {
    var x = form["device_select"].value;
    if (x == "no device") {
        alert("Must select device");
        return false;
		}
	}

	function validateSearch(form){
		var x = form["search"].value;
		if (x == ""){
			alert("Empty Search");
			return false;
		}
	}

	function checkLoginState() {
		  FB.getLoginStatus(function(response) {
		    statusChangeCallback(response);
		  });
		}

	function onFacebookLogin(){
		FB.getLoginStatus(function(response) {
  		if (response.status === 'connected') {
	   		var accessToken = response.authResponse.accessToken;
	   		var fb_id = response.authResponse.userID;
	   		document.getElementById("fbLoginToken").value = accessToken;
	   		document.getElementById("fbLoginId").value = fb_id;
	   		document.getElementById("fbLoginForm").submit();

			}
		});
	}



	function toggleFollowButton(my_gid, their_gid)
	{
		if($("button[name=" + their_gid + "]").hasClass("btn btn-success")){
			var xmlHttp = new XMLHttpRequest();
		    xmlHttp.open( "GET", "/unfollow?my_gid=" + my_gid + "&their_gid=" + their_gid, true ); // false for synchronous request
		    xmlHttp.send( null );
			$("button[name=" + their_gid + "]").removeClass("btn btn-success");
			$("button[name=" + their_gid + "]").addClass("btn btn-default");
			$("span[name=" + their_gid + "]").text("Follow");
			return xmlHttp.responseText;
		}
		else{
			var xmlHttp = new XMLHttpRequest();
		    xmlHttp.open( "GET", "/follow?my_gid=" + my_gid + "&their_gid=" + their_gid, true ); // false for synchronous request
		    xmlHttp.send( null );
			$("button[name=" + their_gid + "]").removeClass("btn btn-default");
			$("button[name=" + their_gid + "]").addClass("btn btn-success");
			$("span[name=" + their_gid + "]").text("Following");
			return xmlHttp.responseText;	
		}
	}

	function switchMoved(my_switch, my_gid, their_gid)
	{

		if($(my_switch).prop('checked')==false)
		{
		    var xmlHttp = new XMLHttpRequest();
		    xmlHttp.open( "GET", "/unfollow?my_gid=" + my_gid + "&their_gid=" + their_gid, true ); // false for synchronous request
		    xmlHttp.send( null );
		    var temp_string = "toggle_" + their_gid;
		    var toggles = document.getElementsByName(temp_string);
		    console.log(toggles);
		    /*
		    for (var i = 0; i < toggles.length; i++) {
		    	toggles[i].checked = false; 
			}
			*/

		
			$('#test-toggle').data("bs.toggle").off(true)


			return xmlHttp.responseText;

		}
		else
		{
			var xmlHttp = new XMLHttpRequest();
		    xmlHttp.open( "GET", "/follow?my_gid=" + my_gid + "&their_gid=" + their_gid, true ); // false for synchronous request
		    xmlHttp.send( null );
		    var toggles = document.getElementsByName("toggle_" + their_gid);
		    return xmlHttp.responseText;	
		}

	}

	var interval = 10000;
	function LoadFollowers()
	{
		$.ajax({
		  type : 'POST',
		  url : "/ajax_test",
		  contentType: 'application/json;charset=UTF-8',
		  success: function (data){
		  	
		  		$("span[name=" + data.me["my_gid"] + "_song]").text(data.me["my_song"]);
				$("span[name=" + data.me["my_gid"] + "_artist]").text(data.me["my_artist"]);
				if (data.following[0]["listening"] == 0){
					$("div[name=my_listeners]").html("<div style='text-align:center; font-size:1.5em' class='list-group-item list-group-item-action flex-column align-items-start'>No Listeners Yet!</div>");
				}

				for (i = 0; i < data.following.length; i++) {
					$("a[name=" + data.following[i]['gid'] + "]").attr('data-order', i);
					if (data.following[i]["private"] == 1){
						$("div[name=" + data.following[i]["gid"] + "_colright]").html("");	
						$("div[name=" + data.following[i]["gid"] + "_colcenter]").html("<div style='font-size: 1.5em; padding-left:10px; vertical-align: top;'>" + data.following[i]['name'] + "</div><div style='font-size: 1.0em; padding-left:15px; vertical-align: bottom;'>Private Session</div>");
						$("div[name=" + data.following[i]['gid'] + "_modal_footer]").html("");
						$("h4[name=" + data.following[i]['gid'] + "]").html("<font face='verdana'>Private Session</font>");

					}
					else{
						if (data.following[i]["listening"] == 1){
							$("a[name=" + data.following[i]['gid'] + "]").css('background-color', '#79c3f7');
							$("a[name=" + data.following[i]['gid'] + "]").attr('data-order', i);
							$("div[name=" + data.following[i]['gid'] + "_modal_footer]").html("<div class='form-group row'> <form name='tune_out_form' action='/tune_out' method = 'POST'><input type='hidden' name='tune_out_my_gid' value=" + data.me["my_gid"] + " onsubmit='setTimeout(function () { window.location.reload(); }, 10)''><div class='col-md-3'><span><button type='submit' class='btn btn-warning'> Tune Out</button></span></div></form></div>");
							
						}
						else{
							$("a[name=" + data.following[i]['gid'] + "]").css('background-color', '#ffffff');
							$("div[name=" + data.following[i]['gid'] + "_modal_footer]").html("<form class='form-inline' name='tune_form' action='/tune_in' method = 'POST' onsubmit='return validateForm(this)'><input type='hidden' name='tune_in_their_gid' value=" + data.following[i]['gid'] + "><input type='hidden' name='tune_in_my_gid' value=" + data.me['my_gid'] + "><label class='btn'><input type='checkbox' hidden name='anonymous'><i class='fa fa-square-o fa-2x'></i><i class='fa fa-check-square-o fa-2x'></i><span style='font-size: 1.2em;'> Anonymous?</span></label><button type='submit' class='btn btn-primary' style='font-size:1.0em;'>Tune In</button></form>");
						}
						

						var new_string = data.following[i]["song"] + " by " + data.following[i]["artist"];
						$("div[name=" + data.following[i]["gid"] + "]").text(new_string);
						if(data.following[i]["playing"] == 1){
							/*
							$("img[name=" + data.result[i]["gid"] + "]").css('display', 'block');
							$("img[name=" + data.result[i]["gid"] + "]").attr('src',"/static/images/green.gif");
							*/
							$("div[name=" + data.following[i]["gid"] + "_colright]").html("<img name=" + data.following[i]['gid'] + " src='/static/images/green.gif' style='border:none; display:block; margin:0 auto; height:35%; width:35%;'>");
							$("h4[name=" + data.following[i]['gid'] + "]").html(data.following[i]['name'] + " - <font face='verdana' color='green'>Active</font>");

						}
						else{
							$("div[name=" + data.following[i]["gid"] + "_colright]").html("Inactive");
							$("h4[name=" + data.following[i]['gid'] + "]").html(data.following[i]['name'] + " - <font face='verdana' color='red'>Inactive</font>");

						}
						
					}

				}

				var $list = document.getElementsByClassName('list-group')[0];
			    var listGroupA = $list.getElementsByTagName('a');
			    var $listGroupA = [];
			    for (var i = 0; i < listGroupA.length; ++i) {
			        $listGroupA.push(listGroupA[i]);
			    }
			    $listGroupA.sort(function (a, b) {

			        return 1 * (a.getAttribute('data-order') - b.getAttribute('data-order'));

			    });
			    for (var i = 0; i < $listGroupA.length; i++) {
			        $list.removeChild($listGroupA[i]);
			    }
			    for (var i = 0; i < $listGroupA.length; i++) {
			        $list.appendChild($listGroupA[i]);
			    }


			
			},
	      complete: function (data) {
                // Schedule the next
                setTimeout(LoadFollowers, interval);
        	}
		});
	}
	setTimeout(LoadFollowers, interval);


	</script>



		
	</head>
	<body>
<form  id="fbLoginForm" action="/fb_login" method = "POST"><input type="hidden" name="fbLoginToken" id="fbLoginToken" value="null"><input type="hidden" name="fbLoginId" id="fbLoginId" value="null">
</form>
<nav class="navbar navbar-default">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <img src="/static/images/logo_cropped.png" class="img-circle" alt="Cinque Terre" width="45" height="45" style="vertical-align:bottom">
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">

      <form class="navbar-form navbar-left">
      <!--
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search Users">
        </div>
		
        <button type="submit" class="btn btn-default">Submit</button>
      -->
      </form>
      <ul class="nav navbar-nav navbar-right">
      	{% if logged==false %}
	    <li><a href="/authorize">Login</a></li>

	    {% else %}
	    	<li><a href="/about">About</a></li>
	    	<li>
	    	{% if me.private == 1 %}
		        <a href="/go_public">Go Public</a>
		    {% else %}
		        <a href="/go_private">Go Private</a>
		    {% endif %}
		    </li>
	    	<!--
	        <li class="dropdown">
	          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Other Actions <span class="caret"></span></a>
	          <ul class="dropdown-menu">
	            <li>
	            {% if me.private == 1 %}
		            <a href="/go_public">Go Public</a>
		        {% else %}
		            <a href="/go_private">Go Private</a>
		        {% endif %}
		        <a href="/about">About</a>
		        </li>

	          </ul>
	        </li>
	        -->
	        

	        <li><a href="/logout">Logout</a></li>
	     {% endif %}
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

			<!-- Main -->
			<ul class="nav nav-tabs">
			{% if logged == false %}
				<li class="active"><a data-toggle="tab" href="#friends">Login</a></li>
			{% else %}
				{% if search == false %}
				  <li class="active"><a data-toggle="tab" href="#friends">Friends</a></li>
				  <li><a data-toggle="tab" href="#menu1">You</a></li>
				  <li><a data-toggle="tab" href="#menu2">Search</a></li>
				{% else %}
				  <li><a data-toggle="tab" href="#friends">Friends</a></li>
				  <li><a data-toggle="tab" href="#menu1">You</a></li>
				  <li class="active"><a data-toggle="tab" href="#menu2">Search</a></li>
				{% endif %}
			{% endif %}
			</ul>
	<div class="tab-content">
		{% if search == false %}
  			<div id="friends" class="tab-pane fade in active">
  		{% else %}
  		  	<div id="friends" class="tab-pane fade">
  		{% endif %}
				<section id="main" class="container">
					<!-- <header>
						<h2>Elements</h2>
						<p>Just an assorted selection of elements.</p>
					</header>
					-->
					<!-- <section class="box special"> -->
					<header>

						{% if logged == false %}
							<h2 style="display:inline; padding-right:10px">Guppy</h2>

							<img src="/static/images/logo_cropped.png" class="img-circle" alt="Cinque Terre" width="75" height="75" style="vertical-align:bottom">
							<br>
							<h3>Share your music with friends. <a href="/authorize">Login</a> to get started</h3>
						{% else %}


							<h2 align="center">Your Friends</h2>
							{% if me.fb_token_valid==1 %}
							<h4 align="center" style="margin-bottom: 10px;">Looking for more? <a href="/refresh_fb_friends">Refresh Facebook Friends</a>
							</h4>
							{% else %}
								<h4 align="center" style="margin-bottom: 10px;">Looking for more?</h4>
								<div id="wrapper" style="text-align: center">    
								    <div class="fb-login-button" data-max-rows="1" data-size="medium" data-button-type="continue_with" data-show-faces="false" data-auto-logout-link=false data-use-continue-as="false" data-scope="public_profile,user_friends" onlogin="onFacebookLogin()">
								
								    </div>
								</div>
							{% endif %}
						{% endif %}

					</header>

					{% with messages = get_flashed_messages(with_categories=true) %}
					  <!-- Categories: success (green), info (blue), warning (yellow), danger (red) -->
					  {% if messages %}
					    {% for category, message in messages %}
					      <div class="alert alert-{{ category }} alert-dismissible" role="alert">
					      <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					      <!-- <strong>Title</strong> --> {{ message }}
					      </div>
					    {% endfor %}
					  {% endif %}
					{% endwith %}
										<!-- </section> -->
						
						<div class="list-group" style="max-height:40vh; overflow: auto">


						{% for f in following %}
						
							{% if f.listening == 1 %}
								<a name="{{ f.gid }}" data-toggle="modal" href="#{{ f.gid }}" class="list-group-item list-group-item-action flex-column align-items-start" style="background-color: #79C3F7;">
							{% else %}
								<a name="{{ f.gid }}" data-toggle="modal" href="#{{ f.gid }}" class="list-group-item list-group-item-action flex-column align-items-start" style="background-color: #ffffff";>
							{% endif %}
								<div id="parent" style="width:100%">  
								  <div id="colLeft">								
								  	<img src={{ f.prof_pic }} style="vertical-align: middle; height:100%; width:100%;">
								  </div>
								    <div id="colwrap">
								      <div name="{{ f.gid }}_colright" id="colRight">
								      {% if f.private != 1 %}
									      {% if f.listening_status == 1 %}
									      	{% if f.anonymous == 1 %}
									      		<img name="{{ f.gid }}" src="/static/images/anon.png" class="img-circle" style="border:none; display:block; margin:0 auto; height:35%; width:35%;">
									      	{% else %}
									      		<img name="{{ f.gid }}" src={{ f.listening_prof }} class="img-circle" style="border:none; display:block; margin:0 auto; height:35%; width:35%;">
									      	{% endif %}
										  {% elif f.playing == 1 %}
									      	<img name="{{ f.gid }}" src="/static/images/green.gif" style="border:none; display:block; 
									      		margin:0 auto; height:35%; width:35%;">
									      {% elif f.playing == 0 %}
											Inactive								      
									      {% endif %}
									  {% endif %}

								      </div>
								      <div name ="{{ f.gid }}_colcenter" id="colCenter">

								      {% if f.private == 1 %}
								      	<div style="font-size: 1.5em; padding-left:10px; vertical-align: top;">{{ f.name }}</div>
								      	<div style="font-size: 1.0em; padding-left:15px; vertical-align: bottom;">Private Session</div>
								      {% else %}
								      	<div style="color: black; font-size: 1.5em; padding-left:10px; vertical-align: top;">{{ f.name }}</div>

											{% if f.anonymous == 1 %}
												<div style="color: black; font-size: 1.0em; padding-left:15px; vertical-align: bottom;">Listening anonymously</div>
											{% else %}
												<div name="{{ f.gid }}" style="color: black; font-size: 1.0em; padding-left:15px; vertical-align: bottom;">{{ f.song }} by {{f.artist}}</div>
											{% endif %}
							
									  {% endif %}
								      </div>  
								    </div>
								</div>							
							  </a>
							  <div id="{{ f.gid }}" class="modal fade" role="dialog" style="padding-top:40px">
									  <div class="modal-dialog">

										<div class="modal-content">
										  <div class="modal-header">
										 
											<h4 name="{{ f.gid }}" class="modal-title">
											{% if f.private == 1 %}
												{{ f.name }} -
												<font face="verdana">Private Session</font>
											{% elif f.listening_status == 1 %}
												{% if f.anonymous == 1 %}
													{{ f.name }} listening anonymously
												{% else %}
													{% if f.listening_gid != me.my_gid %}
														{{ f.name }} listening to 
														<font face="verdana" color="green">{{ f.listening_name }}</font>
													{% else %}
														{{ f.name }} listening to 
														<font face="verdana" color="green">You</font>
													{% endif %}
												{% endif %}
											{% elif f.playing == 1 %}
												{{ f.name }} - 
												<font face="verdana" color="green">Active</font>
											{% elif f.playing == 0 %}
												{{ f.name }} - 
												<font face="verdana" color="red">Inactive</font>
											{% endif %}
												<button type="button" class="close" data-dismiss="modal">&times;</button>
											</h4>
											

										  </div>
										  <div class="modal-body">
											<img src={{ f.prof_pic }} class="img-circle" height="15%" width="15%" style="vertical-align: middle">
											    	<button name="{{f.gid}}" type="button" class="btn btn-success" onclick="toggleFollowButton({{me.my_gid}}, {{ f.gid }})">
												      <span name="{{f.gid}}" class="glyphicon glyphicon-user">Following</span> 
												    </button>
											{% if f.listening_status == 1 and f.private != 1%}
											<span class="glyphicon glyphicon-arrow-right" aria-hidden="true" style="font-size: 3.0em; vertical-align: middle"></span>
												{% if f.anonymous == 1 %}
													<img src="/static/images/anon.png" class="img-circle" height="15%" width="15%" style="vertical-align: middle">
												{% else %}
													<img src={{ f.listening_prof }} class="img-circle" height="15%" width="15%" style="vertical-align: middle">
												{% endif %}
											{% if f.listening_gid != me.my_gid %}
										    	{% if f.following_listener == 1 %}
												    	<button name="{{f.listener_gid}}" type="button" class="btn btn-success" onclick="toggleFollowButton({{me.my_gid}}, {{ f.listener_gid }})">
													      <span name="{{f.listener_gid}}" class="glyphicon glyphicon-user">Following</span> 
													    </button>
													{% else %}
													    <button name="{{f.listener_gid}}" type="button" class="btn btn-default" onclick="toggleFollowButton({{me.my_gid}}, {{ f.listener_gid }})">
													      <span name="{{f.listener_gid}}" class="glyphicon glyphicon-user">Follow</span> 
													    </button>
													{% endif %}
												{% endif %}
											{% endif %}
										  </div>
										  {% if f.listening_gid != me.my_gid and f.anonymous != 1 and f.private != 1 %}
										  <div name="{{ f.gid }}_modal_footer" class="modal-footer">
										  	{% if f.listening == 1 %}
										  		<div class="form-group row"> 
												  <form name="tune_out_form" action="/tune_out" method = "POST"><input type="hidden" name="tune_out_my_gid" value={{ me.my_gid }} onsubmit="setTimeout(function () { window.location.reload(); }, 10)">
												  <div class="col-md-3">
													<span><button type="submit" class="btn btn-warning"> Tune Out</button></span>
												  </div>
												  
												  </form>
												</div>
										 	
											{% else %}
 												<form class="form-inline" name="tune_form" action="/tune_in" method = "POST" onsubmit="return validateForm(this)">
											 	 {% if f.listening_status == 1 %}
											 	 	<input type="hidden" name="tune_in_their_gid" value={{ f.listening_id }}><input type="hidden" name="tune_in_my_gid" value={{ me.my_gid }}>
											 	 {% else %}
											 	 	<input type="hidden" name="tune_in_their_gid" value={{ f.gid }}><input type="hidden" name="tune_in_my_gid" value={{ me.my_gid }}>
											 	 {% endif %}

													    <label class="btn">
												          <input type="checkbox" hidden name='anonymous'><i class="fa fa-square-o fa-2x"></i><i class="fa fa-check-square-o fa-2x"></i><span style="font-size: 1.2em;"> Anonymous?</span>
												        </label>

	  
													{% if f.listening_status == 1 %}
													  	<button type="submit" class="btn btn-primary" style="font-size:1.0em;">Join</button>
													{% else %}
														<button type="submit" class="btn btn-primary" style="font-size:1.0em;">Tune In</button>
													{% endif %}
													</form>
											{% endif %}



										  </div>

										  {% endif %}
										</div>

									  </div>
									</div>
						 {% endfor %}

						</div>
					
			</div>

		{% if logged == true %}
		<div id="menu1" class="tab-pane fade">
			<section id="main" class="container">
			<header style="margin-bottom: 2em;">

								<div id="center_div" style="overflow: hidden">  
								  <div id="colLeft" style="height:17vh; width:17vh;">								
								  	<img src={{ me.my_prof_pic }} class="img-circle" style="vertical-align: middle; height:100%; width:100%;">
								  </div>
								    <div id="colwrap">
	
								      <div id="colCenter" style="height:20vh; overflow: hidden">
								      	{% if me.private == 1 %}
											<div style="padding-left:15px; margin-bottom: 10px; height:10vh; position:relative;">
												<span style="color: red; font-size: 1.6em; position: absolute; bottom: 0; white-space: nowrap;">Private Session</span>
											</div>
											
											<div style="padding-left:20px; height:10vh;">
												<span style="font-size: 1.2em; white-space: nowrap;">Go <a href="/go_public" style="color: grey;">Public? </span>
											</div>
								      	{% else %}
											<div style="padding-left:15px; margin-bottom: 10px; height:10vh; position:relative;">
												<span name="{{ me.my_gid }}_song" style="font-size: 1.6em; position: absolute; bottom: 0; white-space: nowrap;">{{ me.my_song }}</span>
											</div>
											
											<div style="padding-left:20px; height:10vh;">
												<span name="{{ me.my_gid }}_artist" style="font-size: 1.2em; white-space: nowrap;">{{ me.my_artist }}</span>
											</div>
										{% endif %}

								      </div>  
								    </div>
								</div>

			</header>
					<div name="my_listeners" class="list-group" style="max-height:40vh; overflow: auto">
					{% if following[0].listening ==1 %}
							<a data-toggle="modal" href="#myListeningModal" class="list-group-item list-group-item-action flex-column align-items-start active" style="background-color: #79C3F7; border-color: #79C3F7;">
								<div id="parent" style="width:100%">  
								  <div id="colLeft">								
								  	<img src={{ following[0].prof_pic }} style="vertical-align: middle; height:100%; width:100%;">
								  </div>
								    <div id="colwrap">
								      <div id="colRight">
								      {% if following[0].playing == 1 %}
								      	<img src="/static/images/green.gif" style="border:none; display:block; margin:0 auto; height:35%; width:35%;">
								      {% elif following[0].playing == 0 %}
								      	Inactive
								      {% endif %}
								      </div>
								      <div id="colCenter">
										<div style="color: black;font-size: 1.5em; padding-left:10px; vertical-align: top;">{{ following[0].name }}</div>
										
										<div name={{ following[0].gid }} style="color: black; font-size: 1.0em; padding-left:15px; vertical-align: bottom;">{{ following[0].song }} by {{following[0].artist}}</div>

								      </div>  
								    </div>
								</div>		

							  </a>
							  
							  <div id="myListeningModal" class="modal fade" role="dialog" style="padding-top:40px">
									  <div class="modal-dialog">

										<!-- Modal content-->
										<div class="modal-content">
										  <div class="modal-header">
										 
											<h4 class="modal-title">
												{% if following[0].playing == 1 %}
													{{ following[0].name }} - 
													<font face="verdana" color="green">Active</font>
													<button type="button" class="close" data-dismiss="modal">&times;</button>
												{% elif following[0].playing == 0 %}
													{{ following[0].name }} - 
													<font face="verdana" color="red">Inactive</font>
													<button type="button" class="close" data-dismiss="modal">&times;</button>
												{% endif %}
											</h4>
											

										  </div>
										  <div class="modal-body">
											<img src={{ following[0].prof_pic }} class="img-circle" height="90" width="90" style="vertical-align: middle">
									    	{% if following[0].following == 1 %}
											    <button name="{{following[0].gid}}" type="button" class="btn btn-success" onclick="toggleFollowButton({{me.my_gid}}, {{ following[0].gid }})">
											      <span name="{{following[0].gid}}" class="glyphicon glyphicon-user">Following</span> 
											    </button>
											{% else %}
											    <button name="{{following[0].gid}}" type="button" class="btn btn-default" onclick="toggleFollowButton({{me.my_gid}}, {{ following[0].gid }})">
											      <span name="{{following[0].gid}}" class="glyphicon glyphicon-user">Follow</span> 
											    </button>
											{% endif %}
										  </div>	
										  <div class="modal-footer">
											<div class="form-group row"> 

											  <form name="tune_out_form" action="/tune_out" method = "POST"><input type="hidden" name="tune_out_my_gid" value={{ me.my_gid }} onsubmit="setTimeout(function () { window.location.reload(); }, 10)">


											  <div class="col-md-3">
												<span><button type="submit" class="btn btn-warning"> Tune Out</button></span>
											  </div>
											  
											  </form>
											</div>
										  </div>
										</div>

									  </div>
									</div>	

					{% else %}
						{% if my_listeners | length > 0 %}
							{% for my_l in my_listeners %}
								<div class="list-group-item list-group-item-action flex-column align-items-start">
									<div id="parent" style="width:100%">  
									  <div id="colLeft">
									  	{% if my_l.anonymous == 1 %}						
									  		<img src="/static/images/anon.png" style="vertical-align: middle; height:100%; width:100%;">
									  	{% else %}
									  		<img src={{ my_l.prof_pic }} style="vertical-align: middle; height:100%; width:100%;">
									  	{% endif %}
									  </div>
									    <div id="colwrap">
									    <div id="colRight" style="width:12vh;">
									   	{% if my_l.anonymous != 1 %}
									    	{% if my_l.following == 1 %}
											    <button name="{{my_l.gid}}" type="button" class="btn btn-success" onclick="toggleFollowButton({{me.my_gid}}, {{ my_l.gid }})">
											      <span name="{{my_l.gid}}"" class="glyphicon glyphicon-user">Following</span> 
											    </button>
											{% else %}
											    <button name="{{my_l.gid}}" type="button" class="btn btn-default" onclick="toggleFollowButton({{me.my_gid}}, {{ my_l.gid }})">
											      <span name="{{my_l.gid}}" class="glyphicon glyphicon-user">Follow</span> 
											    </button>
											{% endif %}
										{% endif %}
									    </div>		
									      <div id="colCenter" >
									      {% if my_l.anonymous == 1 %}
											<div style="font-size: 1.5em; padding-left:10px; vertical-align: top;">Anonymous User</div>
										  {% else %}
										  	<div style="font-size: 1.5em; padding-left:10px; vertical-align: top;">{{ my_l.name }}</div>
										  {% endif %}
									      </div>  
									    </div>
									</div>	
								</div>			
		
						
							 {% endfor %}
						{% else %}
							<div style="text-align:center; font-size:1.5em" class="list-group-item list-group-item-action flex-column align-items-start">
								No Listeners Yet!
							</div>
						{% endif %}
						</div>
					{% endif %}
					
			</section>
		  </div>
		  {% endif %}


		 {% if logged == true %}
		 {% if search == false %}
		  <div id="menu2" class="tab-pane fade" style="background: 	#D8D8D8;">
		 {% else %}
		  <div id="menu2" class="tab-pane fade in active" style="background: 	#D8D8D8;">
		 {% endif %}
			<section id="main" class="container">
			<header style="margin-bottom: 2em;">
				<form action="/search" onsubmit="return validateSearch(this)" method="POST"> 
				  <div class="row">
				    <div style="width:100%; height:10vh;">
				      <div class="input-group" style="width:100%">
						<input type="text" name="search" placeholder="Search..">

				   </div>
				    </div>
				  </div>
				</form>

			</header>
					<div class="list-group" style="max-height:40vh; overflow: auto">
					{% if search == true %}
						{% if search_results | length > 0 %}
							{% for s in search_results %}
								{% if s.listening == 1 %}
								<div class="list-group-item list-group-item-action flex-column align-items-start active" style="background-color: #79C3F7; border-color: #79C3F7;">
								{% else %}
								<div class="list-group-item list-group-item-action flex-column align-items-start">
								{% endif %}
									<div id="parent" style="width:100%">  
									  <div id="colLeft">								
									  	<img src={{ s.prof_pic }} style="vertical-align: middle; height:100%; width:100%;">
									  </div>
									    <div id="colwrap">
									    <div id="colRight" style="width:12vh;">
									    	{% if s.following == 1 %}

											    <button name="{{s.gid}}" type="button" class="btn btn-success" onclick="toggleFollowButton({{me.my_gid}}, {{ s.gid }})">
											      <span name="{{s.gid}}" class="glyphicon glyphicon-user">Following</span> 
											    </button>
											{% else %}
											    <button name="{{s.gid}}" type="button" class="btn btn-default" onclick="toggleFollowButton({{me.my_gid}}, {{ s.gid }})">
											      <span name="{{s.gid}}" class="glyphicon glyphicon-user">Follow</span> 
											    </button>
											{% endif %}
									    </div>	
									    {% if s.private == 1 %}
									    <a style="text-decoration: none; color:grey;">
									      <div id="colCenter" style="width:70%">
											<div style="font-size: 1.5em; padding-left:10px; vertical-align: top;">{{ s.name }}</div>	

											<div style="font-size: 1.0em; padding-left:15px; vertical-align: bottom;">Private Session</div>
									      </div>  
									     </a>
									    {% else %}
									    <a data-toggle="modal" href="#search_{{ s.gid }}" style="text-decoration: none; color: black;">
									      <div id="colCenter" style="width:70%">
											<div style="font-size: 1.5em; padding-left:10px; vertical-align: top;">{{ s.name }}</div>	

											<div style="font-size: 1.0em; padding-left:15px; vertical-align: bottom;">{{ s.song }} by {{s.artist}}</div>
									      </div>  
									     </a>
									     {% endif %}
									    </div>
									</div>	
								</div>	

								{% if s.listening == 1 %}
									<div id="search_{{ s.gid }}" class="modal fade" role="dialog" style="padding-top:40px">
									  <div class="modal-dialog">

										<!-- Modal content-->
										<div class="modal-content">
										  <div class="modal-header">
										 
											<h4 class="modal-title">
												{% if s.playing == 1 %}
													{{ s.name }} - 
													<font face="verdana" color="green">Active</font>
													<button type="button" class="close" data-dismiss="modal">&times;</button>
												{% elif s.playing == 0 %}
													{{ s.name }} - 
													<font face="verdana" color="red">Inactive</font>
													<button type="button" class="close" data-dismiss="modal">&times;</button>
												{% endif %}
											</h4>
											

										  </div>
										  <div class="modal-body">
											<img src={{ s.prof_pic }} class="img-circle" height="90" width="90" style="vertical-align: middle">
									    	{% if s.following == 1 %}
											    <button name="{{s.gid}}" type="button" class="btn btn-success" onclick="toggleFollowButton({{me.my_gid}}, {{ s.gid }})">
											      <span name="{{s.gid}}" class="glyphicon glyphicon-user">Following</span> 
											    </button>
											{% else %}
											    <button name="{{s.gid}}" type="button" class="btn btn-default" onclick="toggleFollowButton({{me.my_gid}}, {{ s.gid }})">
											      <span name="{{s.gid}}" class="glyphicon glyphicon-user">Follow</span> 
											    </button>
											{% endif %}
										  </div>	
										  <div class="modal-footer">
											<div class="form-group row"> 

											  <form name="tune_out_form" action="/tune_out" method = "POST"><input type="hidden" name="tune_out_my_gid" value={{ me.my_gid }} onsubmit="setTimeout(function () { window.location.reload(); }, 10)">


											  <div class="col-md-3">
												<span><button type="submit" class="btn btn-warning"> Tune Out</button></span>
											  </div>
											  
											  </form>
											</div>
										  </div>
										</div>

									  </div>
									</div>	


								{% elif s.private != 1 %}
								<div id="search_{{ s.gid }}" class="modal fade" role="dialog" style="padding-top:40px">
									  <div class="modal-dialog">

										<!-- Modal content-->
										<div class="modal-content">
										  <div class="modal-header">
										 
											<h4 class="modal-title">
											{% if s.listening_status == 1 %}
												{% if s.anonymous == 1 %}
													{{ s.name }} listening anonymously
												{% else %}
													{% if s.listening_id != me.my_gid %}
														{{ s.name }} listening to 
														<font face="verdana" color="green">{{ s.listening_name }}</font>
													{% else %}
														{{ s.name }} listening to 
														<font face="verdana" color="green">You</font>
													{% endif %}
												{% endif %}
												<button type="button" class="close" data-dismiss="modal">&times;</button>
											{% elif s.playing == 1 %}
												{{ s.name }} - 
												<font face="verdana" color="green">Active</font>
												<button type="button" class="close" data-dismiss="modal">&times;</button>
											{% elif s.playing == 0 %}
												{{ s.name }} - 
												<font face="verdana" color="red">Inactive</font>
												<button type="button" class="close" data-dismiss="modal">&times;</button>
											{% endif %}
											</h4>
											

										  </div>
										  <div class="modal-body">
											<img src={{ s.prof_pic }} class="img-circle" height="15%" width="15%" style="vertical-align: middle">
									    	{% if s.following == 1 %}
											    <button name="{{s.gid}}" type="button" class="btn btn-success" onclick="toggleFollowButton({{me.my_gid}}, {{ s.gid }})">
											      <span name="{{s.gid}}" class="glyphicon glyphicon-user">Following</span> 
											    </button>
											{% else %}
											    <button name="{{s.gid}}" type="button" class="btn btn-default" onclick="toggleFollowButton({{me.my_gid}}, {{ s.gid }})">
											      <span name="{{s.gid}}" class="glyphicon glyphicon-user">Follow</span> 
											    </button>
											{% endif %}
											{% if s.listening_status == 1 %}
												<span class="glyphicon glyphicon-arrow-right" aria-hidden="true" style="font-size: 3.0em; vertical-align: middle"></span>

												{% if s.anonymous == 1 %}
													<img src="/static/images/anon.png" class="img-circle" height="15%" width="15%" style="vertical-align: middle">
												{% else %}
													<img src={{ s.listening_prof }} class="img-circle" height="15%" width="15%" style="vertical-align: middle">
													{% if s.listening_gid != me.my_gid %}
												    	{% if s.following == 1 %}
														    <button name="{{s.gid}}" type="button" class="btn btn-success" onclick="toggleFollowButton({{me.my_gid}}, {{ s.listening_gid }})">
														      <span name="{{s.gid}}" class="glyphicon glyphicon-user">Following</span> 
														    </button>
														{% else %}
														    <button name="{{s.gid}}" type="button" class="btn btn-default" onclick="toggleFollowButton({{me.my_gid}}, {{ s.listening_gid }})">
														      <span name="{{s.gid}}" class="glyphicon glyphicon-user">Follow</span> 
														    </button>
														{% endif %}
													{% endif %}
												{% endif %}
											{% endif %}
										  </div>
										  {% if s.listening_id != me.my_gid and s.anonymous != 1 %}

										  <div class="modal-footer">
										 	 <form class="form-inline" name="tune_form" action="/tune_in" method = "POST" onsubmit="return validateForm(this)">
										 	 {% if s.listening_status == 1 %}
										 	 	<input type="hidden" name="tune_in_their_gid" value={{ s.listening_id }}><input type="hidden" name="tune_in_my_gid" value={{ me.my_gid }}>
										 	 {% else %}
										 	 	<input type="hidden" name="tune_in_their_gid" value={{ s.gid }}><input type="hidden" name="tune_in_my_gid" value={{ me.my_gid }}>
										 	 {% endif %}


												  <!--	
												  <label class="custom-control custom-checkbox mb-2 mr-sm-2 mb-sm-0">
												    <input type="checkbox" class="custom-control-input">
												    <span class="custom-control-indicator"></span>
												    <span class="custom-control-description">Anonymous</span>
												  </label>
												  -->

												    <label class="btn">
											          <input type="checkbox" hidden name='anonymous'><i class="fa fa-square-o fa-2x"></i><i class="fa fa-check-square-o fa-2x"></i><span style="font-size: 1.2em;"> Anonymous?</span>
											        </label>

  
												{% if s.listening_status == 1 %}
												  	<button type="submit" class="btn btn-primary" style="font-size:1.0em;">Join</button>
												{% else %}
													<button type="submit" class="btn btn-primary" style="font-size:1.0em;">Tune In</button>
												{% endif %}
												</form>

										  </div>

										  {% endif %}
										</div>

									  </div>
									</div>	
									{% endif %}
		
						
							 {% endfor %}
						{% else %}
						<div style="text-align:center; font-size:1.5em" class="list-group-item list-group-item-action flex-column align-items-start">
							No Results, try again!
						</div>
						{% endif %}
					{% endif %}
					</div>
					
			</section>
		  </div>
		  </div>
		  {% endif %}

					

			<!-- Footer -->
				<footer id="footer">
					<ul class="icons">
						<li><a href="#" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
						<li><a href="#" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
						<li><a href="#" class="icon fa-instagram"><span class="label">Instagram</span></a></li>
						<li><a href="#" class="icon fa-github"><span class="label">Github</span></a></li>
						<li><a href="#" class="icon fa-dribbble"><span class="label">Dribbble</span></a></li>
						<li><a href="#" class="icon fa-google-plus"><span class="label">Google+</span></a></li>
					</ul>
					<ul class="copyright">
						<li>&copy; Untitled. All rights reserved.</li>
					</ul>
				</footer>


		<!-- Scripts -->
			<script src="/static/js/jquery.min.js"></script>
			<script src="/static/js/jquery.dropotron.min.js"></script>
			<script src="/static/js/jquery.scrollgress.min.js"></script>
			<script src="/static/js/skel.min.js"></script>
			<script src="/static/js/util.js"></script>
			<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
			<script src="/static/js/main.js"></script>

	</body>
</html>

{% endblock %}
